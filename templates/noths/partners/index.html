{% extends "base.html" %}

{% block title %}Not On The High Street A–Z Partner Directory{% endblock %}

{% block content %}
  <section class="partner-directory">
    <h1>NOTHS Partners A–Z</h1>

    <!-- A–Z Sticky Nav -->
    <nav class="az-nav sticky-nav">
      <ul class="az-bar">
        {% for letter in letters %}
  	  {% if letter == "#" %}
    	  <li><a href="#letter-hash">#</a></li>
        {% else %}
          <li><a href="#{{ letter }}">{{ letter }}</a></li>
        {% endif %}
        {% endfor %}

      </ul>
    </nav>

    <!-- Partners Grouped by Letter -->
{% for letter, group in partners_by_letter.items() %}
  {% if letter == "#" %}
    <section class="letter-block" id="letter-hash">
  {% else %}
    <section class="letter-block" id="{{ letter }}">
  {% endif %}

        <h2 class="letter-title">{{ letter }}</h2>
        <ul class="partner-columns">
          {% for partner in group %}
            <li>
              <a href="/noths/partners/{{ partner.slug[0] }}/{{ partner.slug }}.html">{{ partner.name }}</a>
            </li>
          {% endfor %}
        </ul>
      </section>
    {% endfor %}
  </section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll(".az-nav a, .persistent-nav a");
    const sections = [];

    navLinks.forEach(link => {
      const id = link.getAttribute("href").replace("#", "");
      const section = document.getElementById(id);
      if (section) {
        sections.push({ id, section });
      }
    });

    function updateActiveNav() {
      let currentId = null;
      const scrollPosition = window.scrollY + (window.innerWidth > 768 ? 180 : 120);

      for (let i = 0; i < sections.length; i++) {
        const { id, section } = sections[i];
        if (section.offsetTop <= scrollPosition) {
          currentId = id;
        } else {
          break;
        }
      }

      navLinks.forEach(link => {
        link.classList.remove("active");
        if (link.getAttribute("href") === `#${currentId}`) {
          link.classList.add("active");
        }
      });
    }

    window.addEventListener("scroll", updateActiveNav);
    updateActiveNav();
  });
</script>
{% endblock %}
