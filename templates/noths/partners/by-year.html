{% extends "base.html" %}

{% block title %}NOTHS Partners by Year{% endblock %}

{% block content %}
<section class="partner-directory">
  {% set total_partners = 0 %}
  {% for year, group in partners_by_year.items() if year != "Unknown" %}
    {% set total_partners = total_partners + group|length %}
  {% endfor %}

  <h1>
    NOTHS Partners by Year Joined
    <small>(Total partners {{ "{:,}".format(total_partners) }})</small>
  </h1>

  <!-- Year Navigation Bar -->
  <nav class="az-nav sticky-nav">
    <ul class="az-bar">
      {% for year, group in partners_by_year.items() if year != "Unknown" %}
        <li>
          <a href="#year-{{ year }}">
            {{ year }} ({{ group|length }})
          </a>
        </li>
      {% endfor %}
    </ul>
  </nav>

  <!-- Partners Grouped by Year -->
  {% for year, group in partners_by_year.items() if year != "Unknown" %}
    <section class="year-block" id="year-{{ year }}">
      <h2 class="year-title">
        {{ year }} <small>({{ group|length }} Partners)</small>
      </h2>
      <ul class="partner-columns">
        {% for partner in group %}
          <li>
            <a href="/noths/partners/{{ partner.slug[0] }}/{{ partner.slug }}.html">
              {{ partner.name }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endfor %}
</section>
{% endblock %}


{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll(".az-nav a, .persistent-nav a");
    const sections = [];

    navLinks.forEach(link => {
      const id = link.getAttribute("href").replace("#", "");
      const section = document.getElementById(id);
      if (section) {
        sections.push({ id, section });
      }
    });

    function updateActiveNav() {
      let currentId = null;
      const scrollPosition = window.scrollY + (window.innerWidth > 768 ? 180 : 120);

      sections.forEach(({ id, section }) => {
        if (section.offsetTop <= scrollPosition) {
          currentId = id;
        }
      });

      navLinks.forEach(link => {
        link.classList.remove("active");
        if (link.getAttribute("href") === `#${currentId}`) {
          link.classList.add("active");
        }
      });
    }

    window.addEventListener("scroll", updateActiveNav);
    updateActiveNav();
  });
</script>
{% endblock %}
