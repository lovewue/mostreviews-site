{% extends "base.html" %}

{% block title %}NOTHS Sellers by Year{% endblock %}

{% block content %}
<section class="seller-directory">
  <h1>NOTHS Sellers by Year Joined</h1>

  <!-- Year Navigation Bar -->
  <nav class="az-nav sticky-nav">
    <ul class="az-bar">
      {% for year in sellers_by_year.keys() if year != "Unknown" %}
        <li><a href="#year-{{ year }}">{{ year }}</a></li>
      {% endfor %}
    </ul>
  </nav>

  <!-- Sellers Grouped by Year -->
  {% for year, group in sellers_by_year.items() if year != "Unknown" %}
    <section class="year-block" id="year-{{ year }}">
      <h2 class="year-title">{{ year }}</h2>
      <ul class="seller-columns">
        {% for seller in group %}
          <li>
            <a href="/noths/sellers/{{ seller.slug[0] }}/{{ seller.slug }}.html">
              {{ seller.name }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </section>
  {% endfor %}
</section>
{% endblock %}


{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll(".az-nav a, .persistent-nav a");
    const sections = [];

    navLinks.forEach(link => {
      const id = link.getAttribute("href").replace("#", "");
      const section = document.getElementById(id);
      if (section) {
        sections.push({ id, section });
      }
    });

    function updateActiveNav() {
      let currentId = null;
      const scrollPosition = window.scrollY + (window.innerWidth > 768 ? 180 : 120);

      // âœ… check all sections instead of breaking early
      sections.forEach(({ id, section }) => {
        if (section.offsetTop <= scrollPosition) {
          currentId = id;
        }
      });

      navLinks.forEach(link => {
        link.classList.remove("active");
        if (link.getAttribute("href") === `#${currentId}`) {
          link.classList.add("active");
        }
      });
    }

    window.addEventListener("scroll", updateActiveNav);
    updateActiveNav();
  });
</script>
{% endblock %}
