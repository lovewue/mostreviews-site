{% extends "base.html" %}

{% block title %}Top 100 Not On The High Street Products{% endblock %}

{% block content %}
<section class="page-hero">
  <h1>
  Top 100 NOTHS Products
  <span class="subheading">All Time</span>
</h1>

  <p class="lead">Discover the most popular products on Not On The High Street based on customer reviews of all time</p>
</section>

<div class="card-grid">
  {% set last_count = None %}
  {% set rank = 0 %}
  {% for product in top_all_time %}
    {% if product.review_count != last_count %}
      {% set rank = loop.index %}
      {% set last_count = product.review_count %}
    {% endif %}

    <a href="{{ product.awin or product.product_url }}"
       class="rank-card"
       target="_blank"
       rel="noopener"
       data-product-url="{{ product.product_url }}">

      <!-- IMAGE FIRST -->
      <img
        src="/Product_Images/{{ product.local_image }}"
        alt="{{ product.name }}"
        class="rank-image"
        loading="lazy"
        onerror="this.onerror=null; this.src='/static/fallbacks/no-image.jpg'">

      <div class="rank-number">#{{ rank }}</div>
      <div class="rank-divider"></div>

      <div class="rank-body">
        <h2 class="rank-name">{{ product.name }}</h2>
        <p class="rank-meta">
          {{ "{:,}".format(product.review_count) }} reviews<br>
          <span class="seller-name">{{ product.partner_name }}</span>
        </p>
      </div>
    </a>
  {% endfor %}
</div>
</section>
{% endblock %}
