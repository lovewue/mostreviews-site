{% extends "base.html" %}

{% block title %}A–Z of Holly & Co Founders{% endblock %}

{% block content %}
  <section class="partner-directory hollyco-page">
    <h1>Holly & Co Founder Directory</h1>
    <p class="lead">
      Discover the creative founders behind Holly & Co — independent makers, artisans and small businesses with big ideas.
    </p>

    <!-- A–Z Sticky Nav -->
    <nav class="az-nav sticky-nav-hollyco">
      <ul class="az-bar">
        {# Build dynamic letter list based only on available groups #}
        {% set available_letters = sellers | map(attribute='first_letter') | list | unique | sort %}
        {% if '#' in available_letters %}
          <li><a href="#letter-hash">#</a></li>
        {% endif %}
        {% for letter in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' %}
          {% if letter in available_letters %}
            <li><a href="#{{ letter }}">{{ letter }}</a></li>
          {% endif %}
        {% endfor %}
      </ul>
    </nav>

    <!-- Founders grouped by letter -->
    {% for letter, group in sellers|groupby("first_letter") %}
      {% set section_id = 'letter-hash' if letter == '#' else letter %}
      <section class="letter-block" id="{{ section_id }}">
        <div class="container">
          <h2 class="letter-title">{{ '#' if letter == '#' else letter }}</h2>

          <div class="card-grid">
            {% for s in group %}
              <a href="{{ s.url }}"
                 class="rank-card"
                 target="_blank"
                 rel="noopener"
                 title="View {{ s.name }} on Holly & Co">

                <!-- IMAGE -->
                <img src="/static/hollyco/storefront_images/{{ s.slug }}.webp"
                     alt="{{ s.name }}"
                     class="rank-image"
                     loading="lazy"
                     onerror="this.onerror=null;this.src='/static/fallbacks/no-image.jpg'">

                <!-- CONTENT -->
                <div class="rank-content">
                  <h3 class="rank-title">{{ s.name }}</h3>
                  {% if s.location %}
                    <p class="rank-subtitle">{{ s.location }}</p>
                  {% endif %}
                </div>

                <!-- BADGES -->
                {% if s.badges %}
                <div class="rank-badges">
                  {% for b in s.badges %}
                  <img src="{{ b.icon_path or b.icon }}"
                       alt="{{ b.title }}"
                       title="{{ b.title }}"
                       class="rank-badge">
                  {% endfor %}
                </div>
                {% endif %}
              </a>
            {% endfor %}
          </div>
        </div>
      </section>
    {% endfor %}
  </section>
{% endblock %}

{% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const navLinks = document.querySelectorAll(".az-nav a, .persistent-nav a");
    const sections = [];

    navLinks.forEach(link => {
      const id = link.getAttribute("href").replace("#", "");
      const section = document.getElementById(id);
      if (section) sections.push({ id, section });
    });

    function updateActiveNav() {
      let currentId = null;
      const scrollPosition = window.scrollY + (window.innerWidth > 768 ? 180 : 120);
      for (const {id, section} of sections) {
        if (section.offsetTop <= scrollPosition) currentId = id;
        else break;
      }
      navLinks.forEach(link => {
        link.classList.toggle("active", link.getAttribute("href") === `#${currentId}`);
      });
    }

    window.addEventListener("scroll", updateActiveNav);
    updateActiveNav();
  });
</script>
{% endblock %}
